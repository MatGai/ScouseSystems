
.code

PUBLIC __readtsc
PUBLIC __readtscserial

__readtsc PROC
    rdtsc          
    shl rdx, 32
    or  rax, rdx
    ret
__readtsc ENDP

__readtscserial PROC
    push rbx

    mov eax, 0
    cpuid              
    rdtsc
    shl rdx, 32
    or  rax, rdx
    mov r8, rax

    mov eax, 0
    cpuid              

    mov rax, r8
    pop rbx
    ret
__readtscserial ENDP


END